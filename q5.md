# q5


## a
```sql
SELECT * FROM users;
```

## b
```sql
SELECT * FROM users WHERE availability=1;
```

## c
```sql
SELECT
  *
FROM
  users
WHERE
  IFNULL(user_id=:user_id, false)
  OR IFNULL(phone_number=:phone_number, false)
  OR IFNULL(username=:username, false);
```

## d
```sql
SELECT
  chat_id
FROM
  chat_members
WHERE member_id=(
  SELECT
    user_id
  FROM
    users
  WHERE
    IFNULL(user_id=:user_id, false)
    OR IFNULL(phone_number=:phone_number, false)
    OR IFNULL(username=:username, false)
);
```

## e
```sql
SELECT * FROM chats WHERE chat_id=:chat_id
```

## f
```sql
SELECT member_id FROM chat_members WHERE chat_id=:chat_id
```

## g
```sql
SELECT
  member_id
FROM
  chat_members
WHERE
  chat_id=:chat_id
  AND 1=(SELECT availability FROM users WHERE user_id=member_id)
```

## h
```sql
SELECT
  member_id
FROM
  chat_members
WHERE
  chat_id=:chat_id
  AND (
    IFNULL(member_id IN (SELECT primary_owner FROM chats WHERE chat_id=:chat_id), false)
    OR IFNULL(member_id IN (SELECT secondary_owner FROM chats WHERE chat_id=:chat_id), false)
  )
```

## i
```sql
SELECT
  member_id
FROM
  chat_members
WHERE
  chat_id=:chat_id
  AND privilage>=(SELECT sending_privilage FROM chats WHERE chat_id=:chat_id)
```

## j
```sql
SELECT
  privilage
FROM
  chat_members
WHERE
  chat_id=:chat_id
  AND member_id=:member_id
```

## k
```sql
SELECT
  message_id
FROM
  messages
WHERE
  chat_id=:chat_id
ORDER BY posted DESC
```

## l
```sql
SELECT 
  message_id
FROM
  messages
WHERE
  chat_id=:chat_id
  AND posted<=:before
  AND posted>=:after
ORDER BY posted DESC
```

## m
```sql
SELECT 
  message_id
FROM
  messages
WHERE
  chat_id=:chat_id
  AND sender_id=:user_id
  AND posted<=:before
  AND posted>=:after
ORDER BY posted DESC
```

## n
```sql
SELECT
  message_id
FROM
  messages
WHERE
  chat_id=:chat_id
  AND posted>(
    SELECT
      MIN(last_seen)
    FROM
      chat_members
    WHERE
      chat_id=:chat_id
  )
```

## o
```sql
SELECT
  message_id
FROM
  messages
WHERE
  chat_id=:chat_id
ORDER BY posted DESC
LIMIT 100
```

## p
```sql
SELECT * FROM messages WHERE message_id=:message_id
```
